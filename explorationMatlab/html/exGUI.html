
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>exGUI</title>
      <meta name="generator" content="MATLAB 7.4">
      <meta name="date" content="2008-01-14">
      <meta name="m-file" content="exGUI"><style>

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head>
   <body>
      <div class="content">
         <h1>exGUI</h1>
         <introduction>
            <p><b>Description:</b>  This is the main GUI file. Goes with the exGUI.fig figure file. There are many dependancies for this to work properly including
               but not limited to the setup*.m files and explore.m a NBV* file and the planning and movement files if real robot is to be
               used
            </p>
         </introduction>
         <h2>Contents</h2>
         <div>
            <ul>
               <li><a href="#1">Function Call</a></li>
               <li><a href="#2">Variables: Setup GUI</a></li>
               <li><a href="#3">Executes on button press in clear_pushbutton.</a></li>
               <li><a href="#4">Exploration Functionality</a></li>
               <li><a href="#5">intial safe pose default scans</a></li>
               <li><a href="#6">TEST 1 - random points</a></li>
               <li><a href="#7">TEST 2 - Non points -using algorithm</a></li>
               <li><a href="#8">Classification</a></li>
               <li><a href="#9">Robot Functionality</a></li>
               <li><a href="#10">Plotting and display simple functions</a></li>
               <li><a href="#11">Not Used By Me</a></li>
            </ul>
         </div>
         <h2>Function Call<a name="1"></a></h2>
         <p><b>Inputs:</b></p>
         <p><i>varargin</i> (unknown) values passed in
         </p>
         <p><b>Returns:</b></p>
         <p><i>varargout</i> (unknown) values returned
         </p><pre class="codeinput"><span class="keyword">function</span> varargout = exGUI(varargin)
</pre><h2>Variables: Setup GUI<a name="2"></a></h2><pre class="codeinput">gui_Singleton = 1;
gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
                   <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
                   <span class="string">'gui_OpeningFcn'</span>, @exGUI_OpeningFcn, <span class="keyword">...</span>
                   <span class="string">'gui_OutputFcn'</span>,  @exGUI_OutputFcn, <span class="keyword">...</span>
                   <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
                   <span class="string">'gui_Callback'</span>,   []);
<span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
<span class="keyword">end</span>

<span class="keyword">if</span> nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
<span class="keyword">else</span>
    <span class="comment">% Main error catching sequence</span>
    <span class="keyword">try</span> gui_mainfcn(gui_State, varargin{:});
    <span class="keyword">catch</span>
        display(<span class="string">'----------------Error-----------------------------'</span>);
        display(lasterr);
        display(<span class="string">'This error in exGUI resulted in termination'</span>)
        errdetails=lasterror;
        <span class="keyword">for</span> stackpnt=1:size(errdetails.stack,1)
            display(errdetails.stack(stackpnt));
            display(<span class="string">'.....................................................'</span>);
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="comment">% End initialization code - DO NOT EDIT</span>

<span class="comment">% --- Executes just before exGUI is made visible.</span>
<span class="keyword">function</span> exGUI_OpeningFcn(hObject, eventdata, handles, varargin)
<span class="comment">% Choose default command line output for exGUI</span>
handles.output = hObject;
<span class="comment">% Update handles structure</span>
guidata(hObject, handles);
<span class="comment">% Clear the GUI and global variables</span>
do_clear(handles);

<span class="comment">% --- Outputs from this function are returned to the command line.</span>
<span class="keyword">function</span> varargout = exGUI_OutputFcn(hObject, eventdata, handles)
varargout{1} = handles.output;

<span class="comment">% --- Executes when user attempts to close figure1.</span>
<span class="keyword">function</span> figure1_CloseRequestFcn(hObject, eventdata, handles)
reply = input(<span class="string">'Do you want to delete the mesh from memory and release object 1/0 [1]: '</span>);
<span class="keyword">if</span> isempty(reply)
    reply = 1;
<span class="keyword">end</span>
<span class="keyword">if</span> reply
    <span class="keyword">global</span> robmap_h;
    <span class="keyword">try</span> robmap_h.release;<span class="keyword">end</span>
<span class="keyword">end</span>
<span class="comment">%try and release platform object</span>
<span class="keyword">global</span> platform_h;
<span class="keyword">try</span> platform_h.release;<span class="keyword">end</span>

delete(hObject);
</pre><h2>Executes on button press in clear_pushbutton.<a name="3"></a></h2><pre class="codeinput"><span class="keyword">function</span> clear_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
clc
do_clear(handles);

<span class="comment">% this is the do_clear function sets up most stuff</span>
<span class="keyword">function</span> do_clear(handles)

<span class="comment">%MANUAL CHECKS: To do before start work</span>
display(<span class="string">'Make sure you have done the following'</span>);
display(<span class="string">'1) Checked the laser is on by running the checklaser.exe file (power cycle if necessary)'</span>);
display(<span class="string">'2) The ROBOT is powered on'</span>);
display(<span class="string">'3) The MOTOR power is on'</span>);
display(<span class="string">'4) Both EMERGENCY STOPs are not on'</span>);
display(<span class="string">'5) Robot is in automatic mode on both pendant and E-stop control'</span>);
display(<span class="string">'6) The robocontroller program is running on pendant and recieveing no communication'</span>);
display(<span class="string">'7) There is no EyeinHand exe running intially in task manager'</span>);

<span class="comment">% display('Note: You should use the vr world robot not toms, you should also draw up the laser to put on the end as the 7th peice');</span>

display(<span class="string">'Pausing so you can do these things'</span>);
pause


<span class="comment">% VR world setup</span>
<span class="comment">% global myworld</span>
<span class="comment">% try close(myworld)</span>
<span class="comment">%     delete(myworld)</span>
<span class="comment">% end</span>
<span class="comment">%</span>
<span class="comment">% vrclear('-force');</span>
<span class="comment">% try myworld=vrworld('Robot.WRL');</span>
<span class="comment">%     open(myworld);</span>
<span class="comment">%     vrfigure(myworld);</span>
<span class="comment">% catch</span>
<span class="comment">%     display('Unable to setup vr world');</span>
<span class="comment">% end</span>


<span class="comment">%sets up the surface map object and then this is used for scanning</span>
<span class="keyword">try</span> <span class="keyword">global</span> robmap_h;
    <span class="keyword">try</span> robmap_h.release;pause(1);<span class="keyword">end</span>
robmap_h=actxserver(<span class="string">'EyeInHand.SurfaceMap'</span>);
robmap_h.registerevent(@myhandler);
<span class="keyword">catch</span>
    display(<span class="string">'EyeInHand Problem: Unable to create surface map'</span>)
<span class="keyword">end</span>

<span class="comment">% try and setup platform object</span>
<span class="keyword">try</span> <span class="keyword">global</span> platform_h;
    <span class="keyword">try</span> platform_h.release;pause(1);<span class="keyword">end</span>
    platform_h = actxserver(<span class="string">'EyeInHand.PlatformCommand'</span>);
<span class="keyword">catch</span>
    display(<span class="string">'EyeInHand Problem: Unable to create platform object'</span>)
<span class="keyword">end</span>


<span class="comment">%clear the main axis</span>
set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3);
colordef <span class="string">white</span>
cla(<span class="string">'reset'</span>)
<span class="comment">%setlights up</span>
camlight
lighting <span class="string">gouraud</span>

set(handles.total_info_text,<span class="string">'String'</span>,<span class="string">'0'</span>);set(handles.total_text,<span class="string">'String'</span>,<span class="string">'0'</span>);
set(handles.best_NBV_listbox,<span class="string">'visible'</span>,<span class="string">'off'</span>);
set(handles.descripbestview_text,<span class="string">'visible'</span>,<span class="string">'off'</span>);
set(handles.useRealRobot_checkbox,<span class="string">'Value'</span>,0);
drawnow;

<span class="comment">%clear the globals for scan, workspace, robot(r,Q), bestviews, PointData, RangeData</span>
clear <span class="string">global</span> <span class="string">workspace</span> <span class="string">scan</span> <span class="string">bestviews</span> <span class="string">Q</span> <span class="string">r</span> <span class="string">PointData</span> <span class="string">RangeData</span> <span class="string">guiglobal</span> <span class="string">densoobj</span> <span class="string">all_views</span> <span class="string">robot_maxreach</span>;

<span class="comment">%Sets up the robot</span>
setuprobot()

<span class="keyword">global</span> guiglobal
guiglobal.ellipseplots=[];
guiglobal.checkFF=1;
guiglobal.plot_ellipse=0;
guiglobal.plotpath=false;

<span class="comment">% Sets up the scanner (scan)</span>
setupscanner();

<span class="comment">%this sets up the joint optimisation and NBV optimisation</span>
setupoptimisation()

<span class="comment">%this funciton sets up the workspace</span>
set(handles.dialog_text,<span class="string">'String'</span>,<span class="string">'Clearing and re-setting up the workspace... Please wait....'</span>);
set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3);

setupworkspace(get(handles.show_unknownpoints_checkbox,<span class="string">'Value'</span>));

<span class="keyword">global</span> all_views
<span class="keyword">if</span> isempty(all_views)
    display(<span class="string">'Having to calculate all_views for exploration, this happens ones only'</span>);
    calc_all_views();
    load <span class="string">all_views.mat</span>
<span class="keyword">end</span>

clc;

set(handles.dialog_text,<span class="string">'String'</span>,<span class="string">'Setup Complete: Lets Explore'</span>);
</pre><h2>Exploration Functionality<a name="4"></a></h2>
         <p>--- Executes on button press in stopflag_checkbox.</p><pre class="codeinput"><span class="keyword">function</span> stopflag_checkbox_Callback(hObject, eventdata, handles)
set(handles.stopflag_checkbox,<span class="string">'Visible'</span>,<span class="string">'off'</span>)
<span class="comment">% hObject    handle to stopflag_checkbox (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Hint: get(hObject,'Value') returns toggle state of stopflag_checkbox</span>


<span class="comment">% --- Executes on button press in go_pushbutton.</span>
<span class="keyword">function</span> go_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
set(handles.stopflag_checkbox,<span class="string">'Value'</span>,0)
set(handles.stopflag_checkbox,<span class="string">'Visible'</span>,<span class="string">'on'</span>)

<span class="comment">%%%CHOOSE THE CURRENT TEST CASE</span>
current_test_case=2;
show_new_info_details=false;
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="comment">% profile clear; profile on;</span>
<span class="keyword">global</span> robot_maxreach optimise workspace scan Q

<span class="comment">%update Q to the latest actual value of the robot</span>
<span class="keyword">if</span> get(handles.useRealRobot_checkbox,<span class="string">'Value'</span>)==1;  use_real_robot_GETJs();<span class="keyword">end</span>

<span class="comment">%start data collection</span>
state_data=collectdata([]);
useNBV=false;
set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3)
</pre><h2>intial safe pose default scans<a name="5"></a></h2><pre class="codeinput"><span class="comment">%since we wish to choose our own default start points</span>
<span class="keyword">for</span> stepcount=2:size(robot_maxreach.default_Q,1)+1
<span class="comment">%     want_to_continue=true;</span>
    want_to_continue=~get(handles.stopflag_checkbox,<span class="string">'Value'</span>);
    <span class="keyword">while</span> want_to_continue &amp;&amp; scan.tries&lt;size(robot_maxreach.default_Q,1)
        <span class="keyword">try</span> explore(handles,useNBV);
            want_to_continue=~get(handles.stopflag_checkbox,<span class="string">'Value'</span>);
            <span class="keyword">if</span> want_to_continue==0; error(<span class="string">'User chose to exit'</span>);<span class="keyword">end</span>
            <span class="keyword">break</span>;
        <span class="keyword">catch</span>; display(lasterr);
            want_to_continue=input(<span class="string">'Type (1) to continue, (2) for keyboard command, (0) to exit\n'</span>);
            <span class="keyword">if</span> want_to_continue==2; keyboard; <span class="keyword">end</span>
            <span class="keyword">if</span> want_to_continue==0; error(<span class="string">'User chose to exit'</span>);<span class="keyword">end</span>
            <span class="keyword">if</span> get(handles.useRealRobot_checkbox,<span class="string">'Value'</span>)==1;
                use_real_robot_GETJs();
                set(handles.stopflag_checkbox,<span class="string">'Value'</span>,0);
                set(handles.stopflag_checkbox,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
            <span class="keyword">end</span>
        <span class="keyword">end</span>;
    <span class="keyword">end</span>
    state_data=collectdata(state_data);
<span class="keyword">end</span>

want_to_continue=~get(handles.stopflag_checkbox,<span class="string">'Value'</span>);
</pre><h2>TEST 1 - random points<a name="6"></a></h2><pre class="codeinput"><span class="keyword">if</span> current_test_case==1 &amp;&amp; want_to_continue
    <span class="keyword">global</span> r bestviews
    qlimits=r.qlim;
    <span class="keyword">for</span> stepcount=1:20
        <span class="comment">%%This is the random find next point</span>
        pathfound=false;
        <span class="keyword">while</span> ~pathfound
            useNBV=true;
            tempendQs=rand(1,6);newQ=[];
            <span class="keyword">for</span> i=1:6
                newQ=[newQ,tempendQs(:,i)*(-qlimits(i,1)+qlimits(i,2))+qlimits(i,1)];
            <span class="keyword">end</span>
            tr=fkine(r,newQ);
            tr_indexed=round(tr(1:3,4)/workspace.inc_size)*workspace.inc_size;
            <span class="keyword">if</span> ~isempty(find(tr_indexed(1)==workspace.knowncoords(:,1)&amp;<span class="keyword">...</span>
                             tr_indexed(2)==workspace.knowncoords(:,2)&amp;<span class="keyword">...</span>
                             tr_indexed(3)==workspace.knowncoords(:,3), 1))
                [pathfound,all_steps]=pathplanner(newQ);
                <span class="keyword">if</span> pathfound; plotdenso(r,newQ,false,false); <span class="keyword">end</span>;
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        bestviews.scanorigin=tr(1:3,4)';
        bestviews.chosenview=sum(tr(1:3,1:3));
        bestviews.tr=tr;
        bestviews.Q=newQ;
        bestviews.all_steps=all_steps;
        bestviews.valid=true;
        <span class="keyword">try</span> explore(handles,useNBV,1);
        <span class="keyword">catch</span> display(lasterr);
        <span class="keyword">end</span>
        <span class="comment">%data collection</span>
        state_data=collectdata(state_data);
    <span class="keyword">end</span>
</pre><h2>TEST 2 - Non points -using algorithm<a name="7"></a></h2><pre class="codeinput"><span class="keyword">elseif</span> current_test_case&gt;1 &amp;&amp; want_to_continue
    <span class="comment">%now go through and get NBV and then use them to explore</span>
    <span class="keyword">for</span> stepcount=stepcount+1:15;
        <span class="keyword">if</span> ~get(handles.stopflag_checkbox,<span class="string">'Value'</span>)
            <span class="comment">%which exploration method to use</span>
<span class="comment">%             if current_test_case==2;NBV_beta();</span>
            <span class="keyword">if</span> current_test_case==2;NBV_beta2();
            <span class="keyword">elseif</span> current_test_case==3; NBV();
            <span class="keyword">end</span>
            <span class="comment">%Prompt to let user know next scans are ready</span>
<span class="comment">%             uiwait(msgbox('Next scans ready to be taken, press ok when ready'))</span>

            current_bestview=1;
            max_bestviews_togothrough=optimise.valid_max*1/4;
            <span class="keyword">global</span> bestviews;
            <span class="keyword">while</span> current_bestview&lt;max_bestviews_togothrough &amp;&amp; size(bestviews,2)&gt;=1 &amp;&amp; ~get(handles.stopflag_checkbox,<span class="string">'Value'</span>)
                <span class="comment">%size(bestviews,2)&gt;optimise.valid_max*3/4</span>
                current_bestview=current_bestview+1;

                useNBV=true;
    <span class="comment">%             want_to_continue=true;</span>
                want_to_continue=~get(handles.stopflag_checkbox,<span class="string">'Value'</span>);

                <span class="keyword">while</span> want_to_continue;
                    <span class="keyword">try</span> <span class="comment">%if we have already planned a path, use this one otherwise try and get another, otherwise go to next possible one</span>
                        <span class="keyword">if</span> movetonewQ(handles,bestviews(1).Q*180/pi,bestviews(1).all_steps);
                            scan.done_bestviews_orfailed=[scan.done_bestviews_orfailed;bestviews(1).Q];explore(handles,useNBV,1);validpathfound=true;<span class="keyword">break</span>;
                        <span class="keyword">else</span> <span class="comment">%can't get to the desired best view</span>
<span class="comment">%                             display('User has control');</span>
<span class="comment">%                             keyboard</span>

                            <span class="comment">%tac on the actual position here just in case</span>
                            <span class="comment">%it isn't exactly where it was supposed to</span>
                            <span class="comment">%finish</span>
                            robot_maxreach.path(end).all_steps(end+1,:)=Q;
                            <span class="comment">%move back along the path taken to get here</span>
                            <span class="keyword">if</span> ~movetonewQ(handles,robot_maxreach.path(end).all_steps(1,:)*180/pi,robot_maxreach.path(end).all_steps(end:-1:1,:));
                                display(<span class="string">'some major problem if we cant follow the same path back'</span>);
                                keyboard
                            <span class="keyword">end</span>
                            <span class="comment">%try once again to move to the actual desired</span>
                            <span class="comment">%newQ for exploration</span>
                            <span class="keyword">if</span> movetonewQ(handles,bestviews(1).Q*180/pi,bestviews(1).all_steps);
                                scan.done_bestviews_orfailed=[scan.done_bestviews_orfailed;bestviews(1).Q];explore(handles,useNBV,1);validpathfound=true;<span class="keyword">break</span>;
                            <span class="keyword">else</span> <span class="comment">% last resort is to remove surrounding obstacle points remove indexed and normal obsticle points within robot FF since not valid</span>
                                display([<span class="string">'No Valid path available or found, on #'</span>,num2str(current_bestview)]);
                                validpathfound=false;
                            <span class="keyword">end</span>
                        <span class="keyword">end</span>

                        want_to_continue=0;
                    <span class="keyword">catch</span>; display(lasterr);
                        want_to_continue=input(<span class="string">' Type (0) to go to new best view, (1) to continue trying for a path, (2) for keyboard command, (3) to exit\n'</span>);
                        <span class="keyword">if</span> want_to_continue==2; keyboard; <span class="keyword">end</span>
                        <span class="keyword">if</span> want_to_continue==3; error(<span class="string">'User chose to exit'</span>);<span class="keyword">end</span>
                        <span class="keyword">if</span> get(handles.useRealRobot_checkbox,<span class="string">'Value'</span>)==1;  use_real_robot_GETJs();<span class="keyword">end</span>
                        display([<span class="string">'No Valid path available or found, on #'</span>,num2str(current_bestview)]);
                        validpathfound=false;
                    <span class="keyword">end</span>;
                <span class="keyword">end</span>

                <span class="keyword">if</span> show_new_info_details
                <span class="comment">%Plotting and dispalying what we expected compared to what we got</span>
                display(strcat(<span class="string">'The size of the expected infor was:'</span>,num2str(size(bestviews(1).expectedaddinfo)),<span class="string">', While the actual size was:'</span>,num2str(size(workspace.newestknownledge)),<span class="keyword">...</span>
                    <span class="string">', The set difference was:'</span>,num2str(size(setdiff(bestviews(1).expectedaddinfo,workspace.newestknownledge,<span class="string">'rows'</span>))),<span class="keyword">...</span>
                    <span class="string">', The weighted addinfo is:'</span>,num2str(bestviews(1).addinfo),<span class="string">'. And the overall weight was:'</span>,num2str(bestviews(1).overall)));
                    temp=plot3(bestviews(1).expectedaddinfo(:,1),bestviews(1).expectedaddinfo(:,2),bestviews(1).expectedaddinfo(:,3),<span class="string">'r.'</span>);
                    temp2=plot3(workspace.newestknownledge(:,1),workspace.newestknownledge(:,2),workspace.newestknownledge(:,3),<span class="string">'g.'</span>);
                    temp3=setdiff(bestviews(1).expectedaddinfo,workspace.newestknownledge,<span class="string">'rows'</span>);
                    temp4=plot3(temp3(:,1),temp3(:,2),temp3(:,3),<span class="string">'b.'</span>);
                    pause(2);
                    delete(temp); delete(temp4);
                    pause(2);delete(temp2);
                <span class="keyword">end</span>

                <span class="comment">%termination conditions</span>
                changeinweight=diff(state_data.knownweight);
                <span class="keyword">if</span> length(changeinweight)&gt;3
                    <span class="keyword">if</span> sum(changeinweight(end-3:end))&lt;100
                        <span class="comment">%set to stop ASAP</span>
                        set(handles.stopflag_checkbox,<span class="string">'Value'</span>,1);
                        display(<span class="string">'Termination condition reached'</span>);
                        <span class="keyword">break</span>;
                    <span class="keyword">end</span>
                <span class="keyword">end</span>

                <span class="keyword">if</span> size(bestviews,2)&gt;1
                    <span class="comment">%Resize bestviews so as to get rid of the first element</span>
                    clear <span class="string">temp_bestviews</span>;
                    <span class="keyword">for</span> cur_view=2:size(bestviews,2); temp_bestviews(cur_view-1)=bestviews(cur_view);<span class="keyword">end</span>
                        bestviews=temp_bestviews;
                        <span class="comment">%if we actually found a place to move and explore</span>
                        <span class="comment">%from record new data</span>
                        <span class="keyword">if</span> validpathfound==true
                            state_data=collectdata(state_data);
                        <span class="keyword">end</span>

                        redo_nbv_vol=true;
                        order_bestviews(redo_nbv_vol);
                <span class="keyword">else</span>
                    bestviews=[];
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>


<span class="comment">%Plotting the results</span>
figure;
subplot(3,1,1);plot(state_data.knownweight);grid <span class="string">on</span>; title(<span class="string">'Known Weight'</span>);
subplot(3,1,2);plot(state_data.size_known);grid <span class="string">on</span>; title(<span class="string">'Total Known Points'</span>);
subplot(3,1,3);plot(state_data.time);grid <span class="string">on</span>; title(<span class="string">'Time Taken'</span>);
save(<span class="string">'state_data.mat'</span>,<span class="string">'state_data'</span>);
testnum=input(<span class="string">'test num'</span>);
saveresultstofile(testnum);

<span class="comment">% profile off; profile viewer;</span>

<span class="comment">% --- Executes on selection change in best_NBV_listbox.</span>
<span class="keyword">function</span> best_NBV_listbox_Callback(hObject, eventdata, handles) <span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> bestviews;
selection=get(handles.best_NBV_listbox,<span class="string">'value'</span>);
<span class="keyword">if</span> bestviews(selection).valid

<span class="comment">%%%%%%%%delete this plotting stuff    %%%%%%%%%%%</span>
<span class="comment">%plot the scanorigin</span>
    tempplothandle=plot3(bestviews(selection).scanorigin(1),bestviews(selection).scanorigin(2),bestviews(selection).scanorigin(3),<span class="string">'r*'</span>);
    hold <span class="string">on</span>;
<span class="comment">%plot the direction</span>
    pointAT=bestviews(selection).chosenview+bestviews(selection).scanorigin;
    tempplothandle= [tempplothandle,plot3([bestviews(selection).scanorigin(1),pointAT(1)],[bestviews(selection).scanorigin(2),pointAT(2)],[bestviews(selection).scanorigin(3),pointAT(3)])];
    uiwait(msgbox(<span class="string">'have a look then press ok'</span>))
    <span class="keyword">try</span> <span class="keyword">for</span> i=1:length(tempplothandle); delete(tempplothandle(i)); <span class="keyword">end</span>; <span class="keyword">end</span>;
<span class="comment">%plot the new info</span>
    tempplothandle= plot3(bestviews(selection).expectedaddinfo(:,1),bestviews(selection).expectedaddinfo(:,2),bestviews(selection).expectedaddinfo(:,3),<span class="string">'y.'</span>);
    uiwait(msgbox(<span class="string">'have a look then press ok'</span>))
    <span class="keyword">try</span> delete(tempplothandle); <span class="keyword">end</span>;
<span class="comment">%%%%%%%%ENDdelete this plotting stuff    %%%%%%%%%%%</span>

    useNBV=true;
<span class="comment">%     explore(handles,useNBV,selection);</span>
<span class="keyword">else</span>
    msgbox(<span class="string">'Not a valid robot pose selected'</span>)
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in find_best_view_pushbutton.</span>
<span class="keyword">function</span> find_best_view_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="comment">%  profile clear;profile on;</span>
<span class="comment">% NBV();</span>
<span class="comment">% NBV_beta();</span>
NBV_beta2();
<span class="comment">%  profile off;profile viewer;</span>

<span class="comment">%publish to the GUi different options</span>
<span class="keyword">global</span> bestviews;

<span class="keyword">for</span> cur_view=1:size(bestviews,2)
    <span class="keyword">if</span> bestviews(cur_view).valid
        bestview_stringcell{cur_view}=<span class="keyword">...</span>
                strcat(<span class="string">'#'</span>,num2str(cur_view),<span class="string">': '</span>,num2str(bestviews(cur_view).overall),<span class="string">', is@('</span>,num2str(bestviews(cur_view).scanorigin),<span class="keyword">...</span>
               <span class="string">'), pose('</span>,num2str(bestviews(cur_view).chosenview),<span class="string">'), Valid('</span>,num2str(bestviews(cur_view).valid),<span class="string">'), addinfoweight=('</span>,num2str(bestviews(cur_view).addinfoweight),<span class="string">'), JointMoveWeight=('</span>,num2str(bestviews(cur_view).jointmoveweight),<span class="string">'), Q=['</span>,num2str(bestviews(cur_view).Q),<span class="string">']'</span>);
     <span class="keyword">end</span>
<span class="keyword">end</span>

set(handles.best_NBV_listbox,<span class="string">'string'</span>,bestview_stringcell,<span class="string">'Value'</span>,1);
set(handles.best_NBV_listbox,<span class="string">'visible'</span>,<span class="string">'on'</span>);
set(handles.descripbestview_text,<span class="string">'visible'</span>,<span class="string">'on'</span>);


<span class="comment">% --- Executes on button press in remove_selfscan_pushbutton.</span>
<span class="keyword">function</span> remove_selfscan_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> workspace
<span class="comment">%remove indexed and normal obsticle points within robot FF since not valid</span>
workspace.indexedobsticles=remove_self_scanning(workspace.indexedobsticles);
<span class="comment">% workspace.Nobsticlepoints=remove_self_scanning(workspace.Nobsticlepoints);</span>

<span class="comment">% --- Executes on button press in threeDmedianfilter_pushbutton.</span>
<span class="keyword">function</span> threeDmedianfilter_pushbutton_Callback(hObject, eventdata, handles)
threeDMedianFilt();
</pre><h2>Classification<a name="8"></a></h2>
         <p>--- Executes on button press in classify_scan_pushbutton.</p><pre class="codeinput"><span class="keyword">function</span> classify_scan_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> scan
<span class="comment">%case 1 = 'Grey Metal '; case 2 = 'Shiny Metal'; case 3 = 'Cloth/Wood'; OR RED OR WHITE --- JUST CLOTH or WOOD!!! case 4 = 'Do not know';</span>

<span class="comment">%if NOT USING real robot load data</span>
<span class="keyword">if</span> ~get(handles.useRealRobot_checkbox,<span class="string">'Value'</span>)
    display(<span class="string">'Inputing data for classification from file'</span>);
    load <span class="string">ScanforClassifier-0to-60.mat</span>
    scan.IntensityData=IntensityData;
    scan.PointData=PointData;
    scan.RangeData=RangeData;
<span class="keyword">else</span>
<span class="comment">%     movetonewQ(handles,[90,-30,80,0,-25,0]);</span>
     movetonewQ(handles,[0,-30,80,0,-15,0]);
     use_real_robot_SCAN(-70);
<span class="comment">%     figure;imshow(scan.RangeData/max(max(scan.RangeData)));</span>
<span class="comment">%     figure;imshow(scan.IntensityData/max(max(scan.IntensityData)));</span>
<span class="keyword">end</span>

<span class="comment">%check that PointData exists and is valid</span>
<span class="keyword">if</span> isfield(scan,<span class="string">'PointData'</span>)
    <span class="keyword">if</span> size(scan.PointData,2)==0
      error(<span class="string">'Cant classify since there is no PointData available'</span>);
    <span class="keyword">end</span>
<span class="keyword">else</span> error(<span class="string">'Cant classify since no PointData has been saved to the scan structure - Take a scan with real robot'</span>);
<span class="keyword">end</span>

<span class="comment">%check that IntensityData exists and is valid</span>
<span class="keyword">if</span> isfield(scan,<span class="string">'IntensityData'</span>)
    <span class="keyword">if</span> size(scan.IntensityData,2)==0
      error(<span class="string">'Cant classify since there is no IntensityData available'</span>);
    <span class="keyword">end</span>
<span class="keyword">else</span> error(<span class="string">'Cant classify since no IntensityData has been saved to the scan structure - Take a scan with real robot'</span>);
<span class="keyword">end</span>

<span class="comment">%check that PointData exists and is valid</span>
<span class="keyword">if</span> isfield(scan,<span class="string">'RangeData'</span>)
    <span class="keyword">if</span> size(scan.RangeData,2)==0
      error(<span class="string">'Cant classify since there is no RangeData available'</span>);
    <span class="keyword">end</span>
<span class="keyword">else</span> error(<span class="string">'Cant classify since no RangeData has been saved to the scan structure - Take a scan with real robot'</span>);
<span class="keyword">end</span>

<span class="comment">%do classification with data</span>
display(<span class="string">'Classifying the LATEST set of data that has been scanned'</span>);
scan.ClassificationData=[];
<span class="keyword">try</span>
    scan.ClassificationData=Block_Classifier(scan.PointData, scan.IntensityData,scan.RangeData);
    axis <span class="string">equal</span>
    display(<span class="string">'....Classification completed successfully'</span>);
<span class="keyword">catch</span>
    display(<span class="string">'....Problems in Classification'</span>);
    keyboard
<span class="keyword">end</span>




<span class="comment">% --- Executes on button press in plot_classified_pushbutton.</span>
<span class="keyword">function</span> plot_classified_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> scan

<span class="keyword">if</span> ~isfield(scan,<span class="string">'ClassificationData'</span>) || size(scan.ClassificationData,1)==0
    error(<span class="string">'Classification has not happened correctly'</span>);
<span class="keyword">end</span>
<span class="comment">%case 1 = 'Grey Metal '; case 2 = 'Shiny Metal'; case 3 = 'Cloth/Wood'; % OR RED OR WHITE --- JUST CLOTH or WOOD!!! case 4 = 'Do not know';</span>

maxclasval=max(scan.ClassificationData(:,4))

<span class="comment">%Go through and plot the different data</span>
figure(2);hold <span class="string">on</span>;axis <span class="string">equal</span>;
<span class="comment">%set(gcf,'CurrentAxes',handles.axes3);</span>
<span class="keyword">for</span> current_mat=1:maxclasval
    temp=find(scan.ClassificationData(:,4)==current_mat);
    <span class="keyword">if</span> ~isempty(temp)
        <span class="keyword">switch</span>(current_mat)
            <span class="keyword">case</span> (1)
                plotcolor=[.6 .6 .6];
            <span class="keyword">case</span> (2)
                plotcolor=[.4 .4 .4];
            <span class="keyword">case</span> (3)
                plotcolor=[1 0 0];
            <span class="keyword">case</span> (4)
                plotcolor=[0.8 0.8 1];
        <span class="keyword">end</span>
        <span class="keyword">if</span> current_mat~=5 plot3(scan.ClassificationData(temp,1),scan.ClassificationData(temp,2),scan.ClassificationData(temp,3),<span class="string">'Marker'</span>,<span class="string">'.'</span>,<span class="string">'Color'</span>,[plotcolor],<span class="string">'LineStyle'</span>,<span class="string">'none'</span>);<span class="keyword">end</span>;
    <span class="keyword">end</span>
<span class="keyword">end</span>

ClassifiedData=[];
colsiz=size(scan.ClassificationData,1)/size(scan.PointData,1);

<span class="keyword">for</span> current_row=1:size(scan.PointData,1)
    ClassifiedData=[ClassifiedData;(scan.ClassificationData((current_row-1)*colsiz+1:current_row*colsiz,4)/maxclasval)'];
<span class="keyword">end</span>

<span class="comment">%figure, imshow(ClassifiedData);</span>

<span class="comment">%Median filtering</span>
I2=medfilt2(ClassifiedData,[14 14]);
figure, imshow(I2);

Iedges=edge(I2,<span class="string">'canny'</span>);
<span class="comment">%figure, imshow(Iedges);</span>

[row,col]=ginput(1);
<span class="keyword">while</span> col&gt;0 &amp;&amp; col&lt;size(Iedges,1) &amp;&amp; row&gt;0 &amp;&amp; row&lt;size(Iedges,2)
    <span class="keyword">if</span> col&gt;0 &amp;&amp; col&lt;size(Iedges,1) &amp;&amp; row&gt;0 &amp;&amp; row&lt;size(Iedges,2)
        row=round(row)-1+find(Iedges(round(col),round(row):end)&gt;0,1);
        boundary=bwtraceboundary(Iedges,[round(col), round(row)],<span class="string">'N'</span>);
        hold <span class="string">on</span>;
        plot(boundary(:,2),boundary(:,1),<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,3);
    <span class="keyword">end</span>
    [row,col]=ginput(1);
<span class="keyword">end</span>
</pre><h2>Robot Functionality<a name="9"></a></h2>
         <p>--- Executes on button press in blasting_pushbutton.</p><pre class="codeinput"><span class="keyword">function</span> blasting_pushbutton_Callback(hObject, eventdata, handles)
keyboard
<span class="keyword">return</span>

<span class="keyword">global</span> robmap_h
figure(2)
view(2)

<span class="keyword">try</span>
    <span class="keyword">if</span> exist(<span class="string">'verts.mat'</span>,<span class="string">'file'</span>)==2
        load <span class="string">verts.mat</span>;
        surface_making_simple(verts,0.04)
        <span class="keyword">global</span> plane

        pathPlannerV4(handles);
    <span class="keyword">else</span>
        rect_vars=getrect;
        min_max=[rect_vars(1),rect_vars(2),1.4;
        rect_vars(1)+rect_vars(3),rect_vars(2)+rect_vars(4),1.6];

        hMesh = robmap_h.Mesh(min_max);
        verts = hMesh.VertexData;
        save <span class="string">verts</span>

        surface_making_simple(verts,0.04)
        <span class="keyword">global</span> plane

        <span class="keyword">if</span> size(plane,2)&gt;30
            plane=plane(1:30);
        <span class="keyword">end</span>
        save <span class="string">plane</span>
    <span class="keyword">end</span>
<span class="keyword">catch</span>
    error(<span class="string">'failed to get verts or create targets'</span>);
<span class="keyword">end</span>

<span class="comment">%this will be andrew's function</span>
cd <span class="string">RTA</span>
setupoptimisation
keyboard
PathplannerV5(handles)


<span class="comment">% --- Executes on button press in tilt_scan_pushbutton.</span>
<span class="keyword">function</span> tilt_scan_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> r Q guiglobal
<span class="keyword">if</span> get(handles.useRealRobot_checkbox,<span class="string">'Value'</span>)==0
    doscan();
<span class="keyword">else</span>
    deg2scan=str2double(get(handles.tilt_scan_deg_edit,<span class="string">'String'</span>));
    use_real_robot_SCAN(deg2scan);
    organise_data();
    use_real_robot_GETJs();
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in rot_scan_pushbutton.</span>
<span class="keyword">function</span> rot_scan_pushbutton_Callback(hObject, eventdata, handles) <span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> r Q guiglobal
<span class="keyword">if</span> get(handles.useRealRobot_checkbox,<span class="string">'Value'</span>)==0
    error(<span class="string">'Cant do this type of scan yet'</span>);
<span class="keyword">else</span>
    deg2scan=str2double(get(handles.rot_scan_deg_edit,<span class="string">'String'</span>));
    use_real_robot_SCANandMOVE(deg2scan);
    organise_data()
    use_real_robot_GETJs();
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in move_to_pushbutton.</span>
<span class="keyword">function</span> move_to_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="comment">%will move to newQ from the GUI</span>
<span class="comment">% profile clear; profile on;</span>
movetonewQ(handles);
<span class="comment">% profile off; profile viewer;</span>


<span class="comment">% --- Executes on button press in get_current_Js_pushbutton.</span>
<span class="keyword">function</span> get_current_Js_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> Q;
<span class="keyword">if</span> get(handles.useRealRobot_checkbox,<span class="string">'Value'</span>); use_real_robot_GETJs();<span class="keyword">end</span>
actual_Q=Q*180/pi;
display(strcat(<span class="string">'the current joint state of the real robot is:'</span>,num2str(actual_Q)));
set(handles.move_to_J1_edit,<span class="string">'String'</span>,num2str(actual_Q(1)));
set(handles.move_to_J2_edit,<span class="string">'String'</span>,num2str(actual_Q(2)));
set(handles.move_to_J3_edit,<span class="string">'String'</span>,num2str(actual_Q(3)));
set(handles.move_to_J4_edit,<span class="string">'String'</span>,num2str(actual_Q(4)));
set(handles.move_to_J5_edit,<span class="string">'String'</span>,num2str(actual_Q(5)));
set(handles.move_to_J6_edit,<span class="string">'String'</span>,num2str(actual_Q(6)));

<span class="comment">% --- Executes on button press in alloff_pushbutton.</span>
<span class="comment">%turns off all the stuff on the platform</span>
<span class="keyword">function</span> alloff_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
allOff()

<span class="comment">% --- Executes on button press in move2start_platform_pushbutton.</span>
<span class="keyword">function</span> move2start_platform_pushbutton_Callback(hObject, eventdata, handles)
<span class="keyword">global</span> platform_h
<span class="keyword">if</span> isempty(platform_h)
    platform_h = actxserver(<span class="string">'EyeInHand.PlatformCommand'</span>);
<span class="keyword">end</span>
platform_h.Type = <span class="string">'MoveToHome'</span>;
platform_h.Start;


<span class="comment">% --- Executes on button press in move2end_platform_pushbutton.</span>
<span class="keyword">function</span> move2end_platform_pushbutton_Callback(hObject, eventdata, handles)
<span class="keyword">global</span> platform_h
<span class="keyword">if</span> isempty(platform_h)
    platform_h = actxserver(<span class="string">'EyeInHand.PlatformCommand'</span>);
<span class="keyword">end</span>
platform_h.Type = <span class="string">'MoveToEnd'</span>;
platform_h.Start;


<span class="comment">% --- Executes on button press in moveback_platform_pushbutton.</span>
<span class="keyword">function</span> moveback_platform_pushbutton_Callback(hObject, eventdata, handles)
<span class="keyword">global</span> platform_h
<span class="keyword">if</span> isempty(platform_h)
    platform_h = actxserver(<span class="string">'EyeInHand.PlatformCommand'</span>);
<span class="keyword">end</span>
platform_h.Type = <span class="string">'MoveBackward'</span>;
platform_h.Start;


<span class="comment">% --- Executes on button press in moveforward_platform_pushbutton.</span>
<span class="keyword">function</span> moveforward_platform_pushbutton_Callback(hObject, eventdata, handles)
<span class="keyword">global</span> platform_h
<span class="keyword">if</span> isempty(platform_h)
    platform_h = actxserver(<span class="string">'EyeInHand.PlatformCommand'</span>);
<span class="keyword">end</span>
platform_h.Type = <span class="string">'MoveForward'</span>;
platform_h.Start;
<span class="comment">%     platform_h.WaitUntilCompleted(20,0);</span>
<span class="comment">% allOff()</span>


<span class="comment">% platform_h.Type = 'NoMotion';</span>
<span class="comment">% platform_h.Type = 'MoveForward';</span>
<span class="comment">% platform_h.Type = 'MoveBackward';</span>
<span class="comment">% platform_h.Type = 'MoveToHome';</span>
<span class="comment">% platform_h.Type = 'MoveToEnd';</span>


<span class="comment">% platform_h = actxserver('EyeInHand.PlatformState');</span>
<span class="comment">%  get(platform_h,'Status')==0 &amp;&amp; get(platform_h,'EmergencyStop')==0 %%this means OK</span>
<span class="comment">%     platform_h.WarningLight = 1; % Turn on</span>
<span class="comment">%</span>
<span class="comment">%     % platform_h.WarningNoise = 1;</span>
<span class="comment">%     % pause(1)</span>
<span class="comment">%     % platform_h.WarningNoise = 0;</span>
<span class="comment">%</span>
<span class="comment">%     platform_h.AirSupply = 1; % Turn on</span>
<span class="comment">%     platform_h.Brake = 0; % Turn off</span>
<span class="comment">%     platform_h.Motors = 'Forward';</span>
<span class="comment">%     pause(2.0);</span>
<span class="comment">%     platform_h.Motors = 'Off';</span>
<span class="comment">%     platform_h.Brake = 1; % Turn on</span>
<span class="comment">%     platform_h.WarningLight = 0; % Turn on</span>
<span class="comment">%     platform_h.AirSupply = 0; % Turn off</span>

<span class="comment">% platform_h.release</span>
</pre><h2>Plotting and display simple functions<a name="10"></a></h2>
         <p>--- Executes on button press in plot_special_checkbox.</p><pre class="codeinput"><span class="keyword">function</span> plot_special_checkbox_Callback(hObject, eventdata, handles)
<span class="keyword">global</span> workspace guiglobal
<span class="comment">%can't plot before moving the robot once</span>
<span class="keyword">if</span> size(workspace.spec_pnts,1)==0
   error(<span class="string">'not valid when there are no spec_pnts'</span>);
<span class="keyword">else</span>
    hold <span class="string">on</span>;
    set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3);
    <span class="keyword">if</span> ~isfield(guiglobal,<span class="string">'special_pntsplot'</span>)
        guiglobal.special_pntsplot=plot3(workspace.spec_pnts(:,1),workspace.spec_pnts(:,2),workspace.spec_pnts(:,3),<span class="string">'k*'</span>);
        axis <span class="string">vis3d</span>;grid <span class="string">on</span>
    <span class="keyword">else</span>
        <span class="keyword">try</span> delete(guiglobal.special_pntsplot)
        <span class="keyword">catch</span> display(<span class="string">'cant delete the special points plot'</span>);
        <span class="keyword">end</span>
        guiglobal=rmfield(guiglobal,<span class="string">'special_pntsplot'</span>);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in plot_arm_carved_checkbox.</span>
<span class="keyword">function</span> plot_arm_carved_checkbox_Callback(hObject, eventdata, handles)
<span class="keyword">global</span> robot_maxreach guiglobal
<span class="comment">%can't plot before moving the robot once</span>
<span class="keyword">if</span> size(robot_maxreach.pointcarvedout,1)==0
   error(<span class="string">'not valid when there are no points carved out yet'</span>);
<span class="keyword">else</span>
    hold <span class="string">on</span>;
    set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3);
    <span class="keyword">if</span> ~isfield(guiglobal,<span class="string">'pointcarvedout'</span>)
        guiglobal.pointcarvedout=plot3(robot_maxreach.pointcarvedout(:,1),robot_maxreach.pointcarvedout(:,2),robot_maxreach.pointcarvedout(:,3),<span class="string">'b.'</span>);
        axis <span class="string">vis3d</span>;grid <span class="string">on</span>
    <span class="keyword">else</span>
        <span class="keyword">try</span> delete(guiglobal.pointcarvedout)
        <span class="keyword">catch</span> display(<span class="string">'cant delete the pointcarvedout plot'</span>);
        <span class="keyword">end</span>
        guiglobal=rmfield(guiglobal,<span class="string">'pointcarvedout'</span>);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in plotmesh_pushbutton.</span>
<span class="keyword">function</span> plotmesh_pushbutton_Callback(hObject, eventdata, handles)
<span class="keyword">global</span> robmap_h guiglobal

<span class="keyword">try</span> delete(guiglobal.mesh_h);
<span class="keyword">catch</span>
    <span class="comment">% figure(2)</span>
    set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3);
    <span class="comment">% aabb = [-2, -1, 0; 2, 0.6, 2];</span>

    aabb = [-1.5, -1.5, -1; 2, 1.5, 2];
<span class="comment">%     if we want to show the whole environment</span>
    <span class="keyword">if</span> get(handles.all_mesh_checkbox,<span class="string">'value'</span>)==1
        aabb = [-20, -20, -20; 20, 20, 20];
    <span class="keyword">end</span>
    hMesh = robmap_h.Mesh(aabb);
    f = hMesh.FaceData;
    v = hMesh.VertexData;
    <span class="comment">% save('datafile.mat','v');</span>
    hold <span class="string">on</span>;
    guiglobal.mesh_h=trisurf(f, v(:,1), v(:,2), v(:,3), <span class="string">'FaceColor'</span>, <span class="string">'None'</span>);
    axis <span class="string">equal</span>
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in plot_planes_checkbox.</span>
<span class="keyword">function</span> plot_planes_checkbox_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> plane guiglobal
temp_mew=str2double(get(handles.temp_mew_edit,<span class="string">'String'</span>));

theval=get(hObject,<span class="string">'Value'</span>);
<span class="keyword">if</span> theval &amp;&amp; ~isempty(plane)
     temp_plane_plot_handles=plot_planes(plane,temp_mew);
     <span class="keyword">if</span> isfield(guiglobal,<span class="string">'plane_plot_handles'</span>)
         guiglobal.plane_plot_handles=[guiglobal.plane_plot_handles;temp_plane_plot_handles];
     <span class="keyword">else</span>
         guiglobal.plane_plot_handles=temp_plane_plot_handles;
     <span class="keyword">end</span>
<span class="keyword">else</span>
    <span class="keyword">for</span> current_plane=1:size(guiglobal.plane_plot_handles,1); <span class="keyword">try</span> delete(guiglobal.plane_plot_handles(current_plane)); <span class="keyword">end</span>; <span class="keyword">end</span>;
    guiglobal=rmfield(guiglobal, <span class="string">'plane_plot_handles'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in make_surface_pushbutton.</span>
<span class="keyword">function</span> make_surface_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> robmap_h

<span class="keyword">try</span> aabb = [-1.5, -1.5, -1; 2, 1.5, 2];
hMesh = robmap_h.Mesh(aabb);
obsticlepoints = GetImpLevInfo(hMesh.VertexData);
<span class="keyword">catch</span>; error(<span class="string">'In getting the mesh needed for surface making'</span>);
<span class="keyword">end</span>

temp_mew=str2double(get(handles.temp_mew_edit,<span class="string">'String'</span>));
<span class="keyword">if</span> size(obsticlepoints)&gt;0
    set(handles.dialog_text,<span class="string">'String'</span>,<span class="string">'Making planes....'</span>);drawnow;
    surface_making_simple(obsticlepoints,temp_mew);
    set(handles.dialog_text,<span class="string">'String'</span>,<span class="string">'successfully made planes'</span>);
<span class="keyword">else</span>
    set(handles.dialog_text,<span class="string">'String'</span>,<span class="string">'There are no points to make surfaces out of'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in rotate_pushbutton.</span>
<span class="keyword">function</span> rotate_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;INUSD,DEFNU&gt;</span>
rotate3d;

<span class="comment">% --- Executes on button press in ResetView.</span>
<span class="keyword">function</span> ResetView_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;INUSD,DEFNU&gt;</span>
<span class="keyword">global</span> guiglobal
<span class="keyword">try</span> delete(guiglobal.mesh_h);<span class="keyword">end</span>
set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3);
cla(<span class="string">'reset'</span>)
camlight
lighting <span class="string">gouraud</span>
axis <span class="string">equal</span>
view(2);
colordef <span class="string">white</span>

<span class="comment">% --- Executes on button press in sideon_pushbutton.</span>
<span class="keyword">function</span> sideon_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;INUSD,DEFNU&gt;</span>
axis <span class="string">equal</span>;
view(3);

<span class="comment">% --- Executes on button press in plotexplored_pushbutton.</span>
<span class="keyword">function</span> plotexplored_pushbutton_Callback(hObject, eventdata, handles)<span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> workspace guiglobal
<span class="comment">%can't plot before moving the robot once</span>
<span class="keyword">if</span> size(workspace.knowncoords,1)==0
   error(<span class="string">'not valid when there are no explored (known) points'</span>);
<span class="keyword">else</span>
    hold <span class="string">on</span>;
    set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3);
    <span class="keyword">if</span> ~isfield(guiglobal,<span class="string">'exploredplot'</span>)
        guiglobal.exploredplot=plot3(workspace.knowncoords(:,1),workspace.knowncoords(:,2),workspace.knowncoords(:,3),<span class="string">'r.'</span>);
        axis <span class="string">vis3d</span>;grid <span class="string">on</span>
    <span class="keyword">else</span>
        <span class="keyword">try</span> delete(guiglobal.exploredplot)
        <span class="keyword">catch</span> display(<span class="string">'cant delete the exploration plot'</span>);
        <span class="keyword">end</span>
        guiglobal=rmfield(guiglobal,<span class="string">'exploredplot'</span>);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in plot_obstacles_pushbutton.</span>
<span class="keyword">function</span> plot_obstacles_pushbutton_Callback(hObject, eventdata, handles) <span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span>  workspace guiglobal
<span class="keyword">if</span> size(workspace.indexedobsticles,1)==0
   error(<span class="string">'not valid when there are no indexedobsticles points'</span>);
<span class="keyword">else</span>
    set(gcf,<span class="string">'CurrentAxes'</span>,handles.axes3)
    hold <span class="string">on</span>;
    <span class="keyword">if</span> ~isfield(guiglobal,<span class="string">'obsticleplot'</span>)
        guiglobal.obsticleplot=plot3(workspace.indexedobsticles(:,1),workspace.indexedobsticles(:,2),workspace.indexedobsticles(:,3),<span class="string">'g.'</span>);
    <span class="keyword">else</span>
        <span class="keyword">try</span> delete(guiglobal.obsticleplot);
        <span class="keyword">catch</span> display(<span class="string">'cant delete the obsticle plot'</span>);
        <span class="keyword">end</span>
        guiglobal=rmfield(guiglobal,<span class="string">'obsticleplot'</span>);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in show_unknownpoints_checkbox.</span>
<span class="keyword">function</span> show_unknownpoints_checkbox_Callback(hObject, eventdata, handles) <span class="comment">%#ok&lt;INUSD,DEFNU&gt;</span>
<span class="keyword">global</span> guiglobal workspace
<span class="keyword">if</span> ~get(hObject,<span class="string">'value'</span>)
    <span class="keyword">if</span> isfield (guiglobal,<span class="string">'unknownplot'</span>)
        <span class="keyword">for</span> i=1:size(guiglobal.unknownplot,2)
            <span class="keyword">try</span> delete(guiglobal.unknownplot(i))
            <span class="keyword">catch</span> display(<span class="string">'Cant delete unknown points plot'</span>)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        guiglobal=rmfield(guiglobal,<span class="string">'unknownplot'</span>);
    <span class="keyword">end</span>
<span class="keyword">else</span>
    a=round(   workspace.unknowncoords(workspace.lev1unknown   ,:)/workspace.inc_size);
    b=round(     workspace.knowncoords(GetImpLevInfo(workspace.knowncoords)     ,:)/workspace.inc_size);
    c=round(workspace.indexedobsticles(GetImpLevInfo(workspace.indexedobsticles),:)/workspace.inc_size);
    [nothing,index]=setdiff(a,[b;c],<span class="string">'rows'</span>);

    <span class="keyword">if</span> ~isempty(index&gt;0)
        guiglobal.unknownplot(1)=plot3(workspace.unknowncoords(workspace.lev1unknown(index),1),<span class="keyword">...</span>
                                   workspace.unknowncoords(workspace.lev1unknown(index),2),<span class="keyword">...</span>
                                   workspace.unknowncoords(workspace.lev1unknown(index),3),<span class="keyword">...</span>
                                   <span class="string">'.'</span>,<span class="string">'Color'</span>,[1-workspace.dotweight(1) 1-workspace.dotweight(1) 1]);
    <span class="keyword">else</span>
        display(<span class="string">'No Unknown coordinates to plot'</span>);
    <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in show_ellipses_checkbox.</span>
<span class="keyword">function</span> show_ellipses_checkbox_Callback(hObject, eventdata, handles) <span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> r Q guiglobal densoobj
theval=get(hObject,<span class="string">'Value'</span>);
plotrob=get(handles.show_robot_checkbox,<span class="string">'Value'</span>);

<span class="keyword">if</span> theval
    guiglobal.plot_ellipse=1;
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
<span class="keyword">else</span>
    guiglobal.plot_ellipse=0;
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
<span class="keyword">end</span>
<span class="comment">%deletes the robot if it is not needed</span>
<span class="keyword">if</span> ~plotrob <span class="keyword">try</span> <span class="keyword">for</span> piece=1:size(densoobj,2); delete(densoobj(piece).patches); <span class="keyword">end</span>; <span class="keyword">end</span>; <span class="keyword">end</span>;

<span class="comment">% --- Executes on button press in show_robot_checkbox.</span>
<span class="keyword">function</span> show_robot_checkbox_Callback(hObject, eventdata, handles) <span class="comment">%#ok&lt;DEFNU&gt;</span>
<span class="keyword">global</span> r Q guiglobal densoobj
theval=get(hObject,<span class="string">'Value'</span>);
<span class="keyword">if</span> theval
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
<span class="keyword">else</span>
    <span class="keyword">try</span> <span class="keyword">for</span> piece=1:size(densoobj,2); delete(densoobj(piece).patches); <span class="keyword">end</span>; <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in zoom_pushbutton.</span>
<span class="keyword">function</span> zoom_pushbutton_Callback(hObject, eventdata, handles)
zoom <span class="string">on</span>;

<span class="comment">%this function is used to collect the data for exploration to compare new info</span>
<span class="keyword">function</span> state_data=collectdata(state_data)
<span class="keyword">global</span> workspace
<span class="keyword">if</span> isempty(state_data)
    state_data.knownweight=calknownweight();
    state_data.unknownweight=calunknownweight();
    state_data.size_known=size(workspace.knowncoords,1);
    state_data.size_unknown=size(setdiff(round(workspace.unknowncoords/workspace.inc_size),round(workspace.knowncoords/workspace.inc_size),<span class="string">'rows'</span>),1);
    state_data.size_indexedobsticles=size(workspace.indexedobsticles,1);
    state_data.time=0;state_data.starttime=clock;
<span class="keyword">else</span>
    state_data.knownweight=[state_data.knownweight,calknownweight()];
    state_data.unknownweight=[state_data.unknownweight,calunknownweight()];
    state_data.size_known=[state_data.size_known,size(workspace.knowncoords,1)];
    state_data.size_unknown=[state_data.size_unknown,size(setdiff(round(workspace.unknowncoords/workspace.inc_size),round(workspace.knowncoords/workspace.inc_size),<span class="string">'rows'</span>),1)];
    state_data.size_indexedobsticles=[state_data.size_indexedobsticles,size(workspace.indexedobsticles,1)];
    state_data.time=[state_data.time,etime(clock,state_data.starttime)];
<span class="keyword">end</span>



<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</pre><h2>Not Used By Me<a name="11"></a></h2>
         <p>--- Executes during object creation, after setting all properties.</p><pre class="codeinput"><span class="keyword">function</span> best_NBV_listbox_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">else</span>
    set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
<span class="keyword">end</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> slider1_CreateFcn(hObject, eventdata, handles)
usewhitebg = 1;
<span class="keyword">if</span> usewhitebg
    set(hObject,<span class="string">'BackgroundColor'</span>,[.9 .9 .9]);
<span class="keyword">else</span>
    set(hObject,<span class="string">'BackgroundColor'</span>,get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>));
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in useRealRobot_checkbox.</span>
<span class="keyword">function</span> useRealRobot_checkbox_Callback(hObject, eventdata, handles)

<span class="keyword">function</span> tilt_scan_deg_edit_Callback(hObject, eventdata, handles)
<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> tilt_scan_deg_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Joint 1 edit create and callback</span>
<span class="keyword">function</span> move_to_J1_edit_Callback(hObject, eventdata, handles)
<span class="keyword">function</span> move_to_J1_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Joint 2 edit create and callback</span>
<span class="keyword">function</span> move_to_J2_edit_Callback(hObject, eventdata, handles)
<span class="keyword">function</span> move_to_J2_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">%--- Joint 3 edit create and callback</span>
<span class="keyword">function</span> move_to_J3_edit_Callback(hObject, eventdata, handles)
<span class="keyword">function</span> move_to_J3_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Joint 4 edit create and callback</span>
<span class="keyword">function</span> move_to_J4_edit_Callback(hObject, eventdata, handles)
<span class="keyword">function</span> move_to_J4_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Joint 5 edit create and callback</span>
<span class="keyword">function</span> move_to_J5_edit_Callback(hObject, eventdata, handles)
<span class="keyword">function</span> move_to_J5_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Joint 6 edit create and callback</span>
<span class="keyword">function</span> move_to_J6_edit_Callback(hObject, eventdata, handles)
<span class="keyword">function</span> move_to_J6_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in start_with_default_poses_checkbox.</span>
<span class="keyword">function</span> start_with_default_poses_checkbox_Callback(hObject, eventdata, handles)

<span class="comment">% --- Executes on button press in animate_move_checkbox.</span>
<span class="keyword">function</span> animate_move_checkbox_Callback(hObject, eventdata, handles)

<span class="comment">% --- Executes on button press in exact_joints_only_checkbox.</span>
<span class="keyword">function</span> exact_joints_only_checkbox_Callback(hObject, eventdata, handles)

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> temp_mew_edit_Callback(hObject, eventdata, handles)
<span class="keyword">function</span> temp_mew_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --------------------------------------------------------------------</span>
<span class="keyword">function</span> Untitled_1_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to Untitled_1 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --------------------------------------------------------------------</span>
<span class="keyword">function</span> Untitled_2_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to Untitled_2 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --------------------------------------------------------------------</span>
<span class="keyword">function</span> Untitled_3_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to Untitled_3 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --------------------------------------------------------------------</span>
<span class="keyword">function</span> Untitled_4_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to Untitled_4 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --------------------------------------------------------------------</span>
<span class="keyword">function</span> Untitled_5_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to Untitled_5 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --- Executes on button press in all_mesh_checkbox.</span>
<span class="keyword">function</span> all_mesh_checkbox_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to all_mesh_checkbox (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Hint: get(hObject,'Value') returns toggle state of all_mesh_checkbox</span>





<span class="keyword">function</span> rot_scan_deg_edit_Callback(hObject, eventdata, handles)


<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> rot_scan_deg_edit_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in scanwhilemove_checkbox.</span>
<span class="keyword">function</span> scanwhilemove_checkbox_Callback(hObject, eventdata, handles)

<span class="comment">% --- Executes on button press in remv_unkn_in_mv_checkbox.</span>
<span class="keyword">function</span> remv_unkn_in_mv_checkbox_Callback(hObject, eventdata, handles)
</pre><p class="footer"><br>
            Published with MATLAB&reg; 7.4<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
%% exGUI
%
% *Description:*  This is the main GUI file. Goes with the exGUI.fig figure
% file. There are many dependancies for this to work properly including but
% not limited to the setup*.m files and explore.m a NBV* file and the
% planning and movement files if real robot is to be used

%% Function Call
%
% *Inputs:* 
%
% _varargin_ (unknown) values passed in
%
% *Returns:* 
% 
% _varargout_ (unknown) values returned

function varargout = exGUI(varargin)

%% Variables: Setup GUI
gui_Singleton = 1;
gui_State = struct('gui_Name',       mfilename, ...
                   'gui_Singleton',  gui_Singleton, ...
                   'gui_OpeningFcn', @exGUI_OpeningFcn, ...
                   'gui_OutputFcn',  @exGUI_OutputFcn, ...
                   'gui_LayoutFcn',  [] , ...
                   'gui_Callback',   []);
if nargin && ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
end

if nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
else
    % Main error catching sequence
    try gui_mainfcn(gui_State, varargin{:});
    catch
        display('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHErrorREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-');
        display(lasterr);
        display('This error in exGUI resulted in termination')        
        errdetails=lasterror;
        for stackpnt=1:size(errdetails.stack,1)            
            display(errdetails.stack(stackpnt));
            display('.....................................................');
        end   
    end
end
% End initialization code - DO NOT EDIT

% REPLACE_WITH_DASH_DASH- Executes just before exGUI is made visible.
function exGUI_OpeningFcn(hObject, eventdata, handles, varargin)
% Choose default command line output for exGUI
handles.output = hObject;
% Update handles structure
guidata(hObject, handles);
% Clear the GUI and global variables
do_clear(handles);

% REPLACE_WITH_DASH_DASH- Outputs from this function are returned to the command line.
function varargout = exGUI_OutputFcn(hObject, eventdata, handles) 
varargout{1} = handles.output;

% REPLACE_WITH_DASH_DASH- Executes when user attempts to close figure1.
function figure1_CloseRequestFcn(hObject, eventdata, handles)
reply = input('Do you want to delete the mesh from memory and release object 1/0 [1]: ');
if isempty(reply)
    reply = 1;
end
if reply
    global robmap_h;
    try robmap_h.release;end
end
%try and release platform object
global platform_h;
try platform_h.release;end

delete(hObject);


%% Executes on button press in clear_pushbutton.
function clear_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
clc
do_clear(handles);

% this is the do_clear function sets up most stuff
function do_clear(handles)

%MANUAL CHECKS: To do before start work
display('Make sure you have done the following');
display('1) Checked the laser is on by running the checklaser.exe file (power cycle if necessary)');
display('2) The ROBOT is powered on');
display('3) The MOTOR power is on');
display('4) Both EMERGENCY STOPs are not on');
display('5) Robot is in automatic mode on both pendant and E-stop control');
display('6) The robocontroller program is running on pendant and recieveing no communication');
display('7) There is no EyeinHand exe running intially in task manager');

% display('Note: You should use the vr world robot not toms, you should also draw up the laser to put on the end as the 7th peice');

display('Pausing so you can do these things');
pause


% VR world setup
% global myworld
% try close(myworld)
%     delete(myworld)
% end
% 
% vrclear('-force');
% try myworld=vrworld('Robot.WRL');
%     open(myworld);
%     vrfigure(myworld);   
% catch
%     display('Unable to setup vr world');
% end


%sets up the surface map object and then this is used for scanning
try global robmap_h;
    try robmap_h.release;pause(1);end
robmap_h=actxserver('EyeInHand.SurfaceMap');
robmap_h.registerevent(@myhandler);
catch
    display('EyeInHand Problem: Unable to create surface map')
end

% try and setup platform object
try global platform_h;
    try platform_h.release;pause(1);end
    platform_h = actxserver('EyeInHand.PlatformCommand');
catch
    display('EyeInHand Problem: Unable to create platform object')
end


%clear the main axis
set(gcf,'CurrentAxes',handles.axes3);
colordef white
cla('reset')
%setlights up
camlight
lighting gouraud

set(handles.total_info_text,'String','0');set(handles.total_text,'String','0');
set(handles.best_NBV_listbox,'visible','off');
set(handles.descripbestview_text,'visible','off');
set(handles.useRealRobot_checkbox,'Value',0);
drawnow;

%clear the globals for scan, workspace, robot(r,Q), bestviews, PointData, RangeData
clear global workspace scan bestviews Q r PointData RangeData guiglobal densoobj all_views robot_maxreach;

%Sets up the robot
setuprobot()

global guiglobal
guiglobal.ellipseplots=[];
guiglobal.checkFF=1;
guiglobal.plot_ellipse=0;
guiglobal.plotpath=false;

% Sets up the scanner (scan)
setupscanner();

%this sets up the joint optimisation and NBV optimisation 
setupoptimisation()

%this funciton sets up the workspace
set(handles.dialog_text,'String','Clearing and re-setting up the workspace... Please wait....');
set(gcf,'CurrentAxes',handles.axes3);

setupworkspace(get(handles.show_unknownpoints_checkbox,'Value'));

global all_views
if isempty(all_views)
    display('Having to calculate all_views for exploration, this happens ones only');
    calc_all_views();
    load all_views.mat
end

clc;

set(handles.dialog_text,'String','Setup Complete: Lets Explore');


%% Exploration Functionality
% REPLACE_WITH_DASH_DASH- Executes on button press in stopflag_checkbox.
function stopflag_checkbox_Callback(hObject, eventdata, handles)
set(handles.stopflag_checkbox,'Visible','off')
% hObject    handle to stopflag_checkbox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of stopflag_checkbox


% REPLACE_WITH_DASH_DASH- Executes on button press in go_pushbutton.
function go_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
set(handles.stopflag_checkbox,'Value',0)
set(handles.stopflag_checkbox,'Visible','on')

%%%CHOOSE THE CURRENT TEST CASE
current_test_case=2;
show_new_info_details=false;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% profile clear; profile on;
global robot_maxreach optimise workspace scan Q

%update Q to the latest actual value of the robot
if get(handles.useRealRobot_checkbox,'Value')==1;  use_real_robot_GETJs();end   

%start data collection
state_data=collectdata([]);
useNBV=false;
set(gcf,'CurrentAxes',handles.axes3)

%% intial safe pose default scans
%since we wish to choose our own default start points
for stepcount=2:size(robot_maxreach.default_Q,1)+1
%     want_to_continue=true;
    want_to_continue=~get(handles.stopflag_checkbox,'Value');
    while want_to_continue && scan.tries<size(robot_maxreach.default_Q,1)
        try explore(handles,useNBV); 
            want_to_continue=~get(handles.stopflag_checkbox,'Value');
            if want_to_continue==0; error('User chose to exit');end
            break;             
        catch; display(lasterr); 
            want_to_continue=input('Type (1) to continue, (2) for keyboard command, (0) to exit\n');            
            if want_to_continue==2; keyboard; end
            if want_to_continue==0; error('User chose to exit');end
            if get(handles.useRealRobot_checkbox,'Value')==1;  
                use_real_robot_GETJs();
                set(handles.stopflag_checkbox,'Value',0);
                set(handles.stopflag_checkbox,'Visible','on');
            end   
        end; 
    end
    state_data=collectdata(state_data); 
end

want_to_continue=~get(handles.stopflag_checkbox,'Value');

%% TEST 1 - random points
if current_test_case==1 && want_to_continue
    global r bestviews
    qlimits=r.qlim;
    for stepcount=1:20
        %%This is the random find next point
        pathfound=false;
        while ~pathfound
            useNBV=true;
            tempendQs=rand(1,6);newQ=[];
            for i=1:6
                newQ=[newQ,tempendQs(:,i)*(-qlimits(i,1)+qlimits(i,2))+qlimits(i,1)];
            end
            tr=fkine(r,newQ);
            tr_indexed=round(tr(1:3,4)/workspace.inc_size)*workspace.inc_size;
            if ~isempty(find(tr_indexed(1)==workspace.knowncoords(:,1)&...
                             tr_indexed(2)==workspace.knowncoords(:,2)&...
                             tr_indexed(3)==workspace.knowncoords(:,3), 1))                  
                [pathfound,all_steps]=pathplanner(newQ);
                if pathfound; plotdenso(r,newQ,false,false); end;
            end
        end

        bestviews.scanorigin=tr(1:3,4)';
        bestviews.chosenview=sum(tr(1:3,1:3));
        bestviews.tr=tr;            
        bestviews.Q=newQ;
        bestviews.all_steps=all_steps;
        bestviews.valid=true;
        try explore(handles,useNBV,1);
        catch display(lasterr);
        end
        %data collection
        state_data=collectdata(state_data);
    end

%% TEST 2 - Non points -using algorithm
elseif current_test_case>1 && want_to_continue
    %now go through and get NBV and then use them to explore
    for stepcount=stepcount+1:15;
        if ~get(handles.stopflag_checkbox,'Value')
            %which exploration method to use
%             if current_test_case==2;NBV_beta();
            if current_test_case==2;NBV_beta2();
            elseif current_test_case==3; NBV();
            end
            %Prompt to let user know next scans are ready
%             uiwait(msgbox('Next scans ready to be taken, press ok when ready'))

            current_bestview=1;
            max_bestviews_togothrough=optimise.valid_max*1/4;
            global bestviews;        
            while current_bestview<max_bestviews_togothrough && size(bestviews,2)>=1 && ~get(handles.stopflag_checkbox,'Value')
                %size(bestviews,2)>optimise.valid_max*3/4
                current_bestview=current_bestview+1;

                useNBV=true;
    %             want_to_continue=true;
                want_to_continue=~get(handles.stopflag_checkbox,'Value');   
                
                while want_to_continue; 
                    try %if we have already planned a path, use this one otherwise try and get another, otherwise go to next possible one
                        if movetonewQ(handles,bestviews(1).Q*180/pi,bestviews(1).all_steps);
                            scan.done_bestviews_orfailed=[scan.done_bestviews_orfailed;bestviews(1).Q];explore(handles,useNBV,1);validpathfound=true;break;
                        else %can't get to the desired best view
%                             display('User has control');
%                             keyboard
                            
                            %tac on the actual position here just in case
                            %it isn't exactly where it was supposed to
                            %finish
                            robot_maxreach.path(end).all_steps(end+1,:)=Q;
                            %move back along the path taken to get here
                            if ~movetonewQ(handles,robot_maxreach.path(end).all_steps(1,:)*180/pi,robot_maxreach.path(end).all_steps(end:-1:1,:));
                                display('some major problem if we cant follow the same path back');
                                keyboard                                
                            end
                            %try once again to move to the actual desired
                            %newQ for exploration
                            if movetonewQ(handles,bestviews(1).Q*180/pi,bestviews(1).all_steps);
                                scan.done_bestviews_orfailed=[scan.done_bestviews_orfailed;bestviews(1).Q];explore(handles,useNBV,1);validpathfound=true;break;
                            else % last resort is to remove surrounding obstacle points remove indexed and normal obsticle points within robot FF since not valid
                                display(['No Valid path available or found, on #',num2str(current_bestview)]);
                                validpathfound=false;
                            end
                        end
                        
                        want_to_continue=0;                        
                    catch; display(lasterr);
                        want_to_continue=input(' Type (0) to go to new best view, (1) to continue trying for a path, (2) for keyboard command, (3) to exit\n');            
                        if want_to_continue==2; keyboard; end
                        if want_to_continue==3; error('User chose to exit');end
                        if get(handles.useRealRobot_checkbox,'Value')==1;  use_real_robot_GETJs();end 
                        display(['No Valid path available or found, on #',num2str(current_bestview)]);
                        validpathfound=false;
                    end;
                end                

                if show_new_info_details            
                %Plotting and dispalying what we expected compared to what we got
                display(strcat('The size of the expected infor was:',num2str(size(bestviews(1).expectedaddinfo)),', While the actual size was:',num2str(size(workspace.newestknownledge)),...
                    ', The set difference was:',num2str(size(setdiff(bestviews(1).expectedaddinfo,workspace.newestknownledge,'rows'))),...
                    ', The weighted addinfo is:',num2str(bestviews(1).addinfo),'. And the overall weight was:',num2str(bestviews(1).overall)));
                    temp=plot3(bestviews(1).expectedaddinfo(:,1),bestviews(1).expectedaddinfo(:,2),bestviews(1).expectedaddinfo(:,3),'r.');
                    temp2=plot3(workspace.newestknownledge(:,1),workspace.newestknownledge(:,2),workspace.newestknownledge(:,3),'g.');
                    temp3=setdiff(bestviews(1).expectedaddinfo,workspace.newestknownledge,'rows');
                    temp4=plot3(temp3(:,1),temp3(:,2),temp3(:,3),'b.');
                    pause(2);
                    delete(temp); delete(temp4);
                    pause(2);delete(temp2); 
                end

                %termination conditions
                changeinweight=diff(state_data.knownweight);
                if length(changeinweight)>3
                    if sum(changeinweight(end-3:end))<100
                        %set to stop ASAP
                        set(handles.stopflag_checkbox,'Value',1);
                        display('Termination condition reached');
                        break;
                    end
                end
                    
                if size(bestviews,2)>1  
                    %Resize bestviews so as to get rid of the first element
                    clear temp_bestviews;
                    for cur_view=2:size(bestviews,2); temp_bestviews(cur_view-1)=bestviews(cur_view);end
                        bestviews=temp_bestviews;
                        %if we actually found a place to move and explore
                        %from record new data
                        if validpathfound==true
                            state_data=collectdata(state_data); 
                        end

                        redo_nbv_vol=true;
                        order_bestviews(redo_nbv_vol);
                else
                    bestviews=[];
                end
            end
        end
    end
end


%Plotting the results
figure;
subplot(3,1,1);plot(state_data.knownweight);grid on; title('Known Weight');
subplot(3,1,2);plot(state_data.size_known);grid on; title('Total Known Points');
subplot(3,1,3);plot(state_data.time);grid on; title('Time Taken');
save('state_data.mat','state_data');
testnum=input('test num');
saveresultstofile(testnum);

% profile off; profile viewer;

% REPLACE_WITH_DASH_DASH- Executes on selection change in best_NBV_listbox.
function best_NBV_listbox_Callback(hObject, eventdata, handles) %#ok<DEFNU>
global bestviews;
selection=get(handles.best_NBV_listbox,'value');
if bestviews(selection).valid
    
%%%%%%%%delete this plotting stuff    %%%%%%%%%%%
%plot the scanorigin
    tempplothandle=plot3(bestviews(selection).scanorigin(1),bestviews(selection).scanorigin(2),bestviews(selection).scanorigin(3),'r*');
    hold on;
%plot the direction
    pointAT=bestviews(selection).chosenview+bestviews(selection).scanorigin;
    tempplothandle= [tempplothandle,plot3([bestviews(selection).scanorigin(1),pointAT(1)],[bestviews(selection).scanorigin(2),pointAT(2)],[bestviews(selection).scanorigin(3),pointAT(3)])];   
    uiwait(msgbox('have a look then press ok'))
    try for i=1:length(tempplothandle); delete(tempplothandle(i)); end; end;
%plot the new info    
    tempplothandle= plot3(bestviews(selection).expectedaddinfo(:,1),bestviews(selection).expectedaddinfo(:,2),bestviews(selection).expectedaddinfo(:,3),'y.');
    uiwait(msgbox('have a look then press ok'))
    try delete(tempplothandle); end;
%%%%%%%%ENDdelete this plotting stuff    %%%%%%%%%%%
    
    useNBV=true;
%     explore(handles,useNBV,selection);
else
    msgbox('Not a valid robot pose selected')
end

% REPLACE_WITH_DASH_DASH- Executes on button press in find_best_view_pushbutton.
function find_best_view_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
%  profile clear;profile on;
% NBV();
% NBV_beta();
NBV_beta2();
%  profile off;profile viewer;

%publish to the GUi different options
global bestviews;

for cur_view=1:size(bestviews,2)
    if bestviews(cur_view).valid
        bestview_stringcell{cur_view}=...
                strcat('#',num2str(cur_view),': ',num2str(bestviews(cur_view).overall),', is@(',num2str(bestviews(cur_view).scanorigin),...
               '), pose(',num2str(bestviews(cur_view).chosenview),'), Valid(',num2str(bestviews(cur_view).valid),'), addinfoweight=(',num2str(bestviews(cur_view).addinfoweight),'), JointMoveWeight=(',num2str(bestviews(cur_view).jointmoveweight),'), Q=[',num2str(bestviews(cur_view).Q),']');
     end
end

set(handles.best_NBV_listbox,'string',bestview_stringcell,'Value',1);
set(handles.best_NBV_listbox,'visible','on');
set(handles.descripbestview_text,'visible','on');


% REPLACE_WITH_DASH_DASH- Executes on button press in remove_selfscan_pushbutton.
function remove_selfscan_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
global workspace
%remove indexed and normal obsticle points within robot FF since not valid
workspace.indexedobsticles=remove_self_scanning(workspace.indexedobsticles);
% workspace.Nobsticlepoints=remove_self_scanning(workspace.Nobsticlepoints);

% REPLACE_WITH_DASH_DASH- Executes on button press in threeDmedianfilter_pushbutton.
function threeDmedianfilter_pushbutton_Callback(hObject, eventdata, handles)
threeDMedianFilt();


%% Classification
% REPLACE_WITH_DASH_DASH- Executes on button press in classify_scan_pushbutton.
function classify_scan_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
global scan 
%case 1 = 'Grey Metal '; case 2 = 'Shiny Metal'; case 3 = 'Cloth/Wood'; OR RED OR WHITE REPLACE_WITH_DASH_DASH- JUST CLOTH or WOOD!!! case 4 = 'Do not know';

%if NOT USING real robot load data
if ~get(handles.useRealRobot_checkbox,'Value')
    display('Inputing data for classification from file');
    load ScanforClassifier-0to-60.mat
    scan.IntensityData=IntensityData;
    scan.PointData=PointData;
    scan.RangeData=RangeData;
else
%     movetonewQ(handles,[90,-30,80,0,-25,0]);
     movetonewQ(handles,[0,-30,80,0,-15,0]);
     use_real_robot_SCAN(-70);
%     figure;imshow(scan.RangeData/max(max(scan.RangeData)));
%     figure;imshow(scan.IntensityData/max(max(scan.IntensityData)));
end

%check that PointData exists and is valid
if isfield(scan,'PointData')
    if size(scan.PointData,2)==0
      error('Cant classify since there is no PointData available');
    end
else error('Cant classify since no PointData has been saved to the scan structure - Take a scan with real robot');    
end

%check that IntensityData exists and is valid
if isfield(scan,'IntensityData')
    if size(scan.IntensityData,2)==0
      error('Cant classify since there is no IntensityData available');
    end
else error('Cant classify since no IntensityData has been saved to the scan structure - Take a scan with real robot');    
end

%check that PointData exists and is valid
if isfield(scan,'RangeData')
    if size(scan.RangeData,2)==0
      error('Cant classify since there is no RangeData available');
    end
else error('Cant classify since no RangeData has been saved to the scan structure - Take a scan with real robot');    
end

%do classification with data
display('Classifying the LATEST set of data that has been scanned');
scan.ClassificationData=[];
try
    scan.ClassificationData=Block_Classifier(scan.PointData, scan.IntensityData,scan.RangeData);
    axis equal
    display('....Classification completed successfully');    
catch
    display('....Problems in Classification');
    keyboard
end




% REPLACE_WITH_DASH_DASH- Executes on button press in plot_classified_pushbutton.
function plot_classified_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
global scan

if ~isfield(scan,'ClassificationData') || size(scan.ClassificationData,1)==0
    error('Classification has not happened correctly');
end
%case 1 = 'Grey Metal '; case 2 = 'Shiny Metal'; case 3 = 'Cloth/Wood'; % OR RED OR WHITE REPLACE_WITH_DASH_DASH- JUST CLOTH or WOOD!!! case 4 = 'Do not know';

maxclasval=max(scan.ClassificationData(:,4))

%Go through and plot the different data
figure(2);hold on;axis equal;
%set(gcf,'CurrentAxes',handles.axes3);
for current_mat=1:maxclasval
    temp=find(scan.ClassificationData(:,4)==current_mat);
    if ~isempty(temp)
        switch(current_mat)
            case (1) 
                plotcolor=[.6 .6 .6];
            case (2) 
                plotcolor=[.4 .4 .4];
            case (3) 
                plotcolor=[1 0 0];
            case (4) 
                plotcolor=[0.8 0.8 1];
        end        
        if current_mat~=5 plot3(scan.ClassificationData(temp,1),scan.ClassificationData(temp,2),scan.ClassificationData(temp,3),'Marker','.','Color',[plotcolor],'LineStyle','none');end;
    end
end

ClassifiedData=[];
colsiz=size(scan.ClassificationData,1)/size(scan.PointData,1);

for current_row=1:size(scan.PointData,1)
    ClassifiedData=[ClassifiedData;(scan.ClassificationData((current_row-1)*colsiz+1:current_row*colsiz,4)/maxclasval)'];
end

%figure, imshow(ClassifiedData);

%Median filtering
I2=medfilt2(ClassifiedData,[14 14]);
figure, imshow(I2);

Iedges=edge(I2,'canny');
%figure, imshow(Iedges);

[row,col]=ginput(1);  
while col>0 && col<size(Iedges,1) && row>0 && row<size(Iedges,2)        
    if col>0 && col<size(Iedges,1) && row>0 && row<size(Iedges,2)
        row=round(row)-1+find(Iedges(round(col),round(row):end)>0,1);
        boundary=bwtraceboundary(Iedges,[round(col), round(row)],'N');
        hold on;
        plot(boundary(:,2),boundary(:,1),'r','LineWidth',3);
    end
    [row,col]=ginput(1);
end


%% Robot Functionality
% REPLACE_WITH_DASH_DASH- Executes on button press in blasting_pushbutton.
function blasting_pushbutton_Callback(hObject, eventdata, handles)
keyboard
return

global robmap_h
figure(2)
view(2)

try 
    if exist('verts.mat','file')==2 
        load verts.mat;
        surface_making_simple(verts,0.04)
        global plane
        
        pathPlannerV4(handles);
    else
        rect_vars=getrect;
        min_max=[rect_vars(1),rect_vars(2),1.4;
        rect_vars(1)+rect_vars(3),rect_vars(2)+rect_vars(4),1.6];

        hMesh = robmap_h.Mesh(min_max);
        verts = hMesh.VertexData;
        save verts

        surface_making_simple(verts,0.04)
        global plane

        if size(plane,2)>30
            plane=plane(1:30);
        end
        save plane
    end
catch
    error('failed to get verts or create targets');
end

%this will be andrew's function
cd RTA
setupoptimisation
keyboard
PathplannerV5(handles)


% REPLACE_WITH_DASH_DASH- Executes on button press in tilt_scan_pushbutton.
function tilt_scan_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
global r Q guiglobal
if get(handles.useRealRobot_checkbox,'Value')==0
    doscan();
else
    deg2scan=str2double(get(handles.tilt_scan_deg_edit,'String'));
    use_real_robot_SCAN(deg2scan);
    organise_data();
    use_real_robot_GETJs();
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
end

% REPLACE_WITH_DASH_DASH- Executes on button press in rot_scan_pushbutton.
function rot_scan_pushbutton_Callback(hObject, eventdata, handles) %#ok<DEFNU>
global r Q guiglobal
if get(handles.useRealRobot_checkbox,'Value')==0
    error('Cant do this type of scan yet');
else
    deg2scan=str2double(get(handles.rot_scan_deg_edit,'String'));
    use_real_robot_SCANandMOVE(deg2scan);
    organise_data()
    use_real_robot_GETJs();
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
end


% REPLACE_WITH_DASH_DASH- Executes on button press in move_to_pushbutton.
function move_to_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
%will move to newQ from the GUI
% profile clear; profile on;
movetonewQ(handles);
% profile off; profile viewer;


% REPLACE_WITH_DASH_DASH- Executes on button press in get_current_Js_pushbutton.
function get_current_Js_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
global Q;
if get(handles.useRealRobot_checkbox,'Value'); use_real_robot_GETJs();end
actual_Q=Q*180/pi;
display(strcat('the current joint state of the real robot is:',num2str(actual_Q)));
set(handles.move_to_J1_edit,'String',num2str(actual_Q(1)));
set(handles.move_to_J2_edit,'String',num2str(actual_Q(2)));
set(handles.move_to_J3_edit,'String',num2str(actual_Q(3)));
set(handles.move_to_J4_edit,'String',num2str(actual_Q(4)));
set(handles.move_to_J5_edit,'String',num2str(actual_Q(5)));
set(handles.move_to_J6_edit,'String',num2str(actual_Q(6)));

% REPLACE_WITH_DASH_DASH- Executes on button press in alloff_pushbutton.
%turns off all the stuff on the platform
function alloff_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
allOff()

% REPLACE_WITH_DASH_DASH- Executes on button press in move2start_platform_pushbutton.
function move2start_platform_pushbutton_Callback(hObject, eventdata, handles)
global platform_h
if isempty(platform_h)
    platform_h = actxserver('EyeInHand.PlatformCommand');
end
platform_h.Type = 'MoveToHome';
platform_h.Start;


% REPLACE_WITH_DASH_DASH- Executes on button press in move2end_platform_pushbutton.
function move2end_platform_pushbutton_Callback(hObject, eventdata, handles)
global platform_h
if isempty(platform_h)
    platform_h = actxserver('EyeInHand.PlatformCommand');
end
platform_h.Type = 'MoveToEnd';
platform_h.Start;


% REPLACE_WITH_DASH_DASH- Executes on button press in moveback_platform_pushbutton.
function moveback_platform_pushbutton_Callback(hObject, eventdata, handles)
global platform_h
if isempty(platform_h)
    platform_h = actxserver('EyeInHand.PlatformCommand');
end
platform_h.Type = 'MoveBackward';
platform_h.Start;


% REPLACE_WITH_DASH_DASH- Executes on button press in moveforward_platform_pushbutton.
function moveforward_platform_pushbutton_Callback(hObject, eventdata, handles)
global platform_h
if isempty(platform_h)
    platform_h = actxserver('EyeInHand.PlatformCommand');
end
platform_h.Type = 'MoveForward';
platform_h.Start;
%     platform_h.WaitUntilCompleted(20,0);
% allOff()


% platform_h.Type = 'NoMotion';
% platform_h.Type = 'MoveForward';
% platform_h.Type = 'MoveBackward';
% platform_h.Type = 'MoveToHome';
% platform_h.Type = 'MoveToEnd';


% platform_h = actxserver('EyeInHand.PlatformState');
%  get(platform_h,'Status')==0 && get(platform_h,'EmergencyStop')==0 %%this means OK
%     platform_h.WarningLight = 1; % Turn on
% 
%     % platform_h.WarningNoise = 1;
%     % pause(1)
%     % platform_h.WarningNoise = 0;
% 
%     platform_h.AirSupply = 1; % Turn on
%     platform_h.Brake = 0; % Turn off
%     platform_h.Motors = 'Forward';
%     pause(2.0);
%     platform_h.Motors = 'Off';
%     platform_h.Brake = 1; % Turn on
%     platform_h.WarningLight = 0; % Turn on
%     platform_h.AirSupply = 0; % Turn off
     
% platform_h.release


%% Plotting and display simple functions
% REPLACE_WITH_DASH_DASH- Executes on button press in plot_special_checkbox.
function plot_special_checkbox_Callback(hObject, eventdata, handles)
global workspace guiglobal
%can't plot before moving the robot once
if size(workspace.spec_pnts,1)==0
   error('not valid when there are no spec_pnts'); 
else
    hold on;
    set(gcf,'CurrentAxes',handles.axes3);
    if ~isfield(guiglobal,'special_pntsplot')
        guiglobal.special_pntsplot=plot3(workspace.spec_pnts(:,1),workspace.spec_pnts(:,2),workspace.spec_pnts(:,3),'k*');
        axis vis3d;grid on
    else
        try delete(guiglobal.special_pntsplot)
        catch display('cant delete the special points plot');
        end
        guiglobal=rmfield(guiglobal,'special_pntsplot');
    end
end

% REPLACE_WITH_DASH_DASH- Executes on button press in plot_arm_carved_checkbox.
function plot_arm_carved_checkbox_Callback(hObject, eventdata, handles)
global robot_maxreach guiglobal
%can't plot before moving the robot once
if size(robot_maxreach.pointcarvedout,1)==0
   error('not valid when there are no points carved out yet'); 
else
    hold on;
    set(gcf,'CurrentAxes',handles.axes3);
    if ~isfield(guiglobal,'pointcarvedout')
        guiglobal.pointcarvedout=plot3(robot_maxreach.pointcarvedout(:,1),robot_maxreach.pointcarvedout(:,2),robot_maxreach.pointcarvedout(:,3),'b.');
        axis vis3d;grid on
    else
        try delete(guiglobal.pointcarvedout)
        catch display('cant delete the pointcarvedout plot');
        end
        guiglobal=rmfield(guiglobal,'pointcarvedout');
    end
end

% REPLACE_WITH_DASH_DASH- Executes on button press in plotmesh_pushbutton.
function plotmesh_pushbutton_Callback(hObject, eventdata, handles)
global robmap_h guiglobal

try delete(guiglobal.mesh_h);
catch
    % figure(2)
    set(gcf,'CurrentAxes',handles.axes3);
    % aabb = [-2, -1, 0; 2, 0.6, 2];
    
    aabb = [-1.5, -1.5, -1; 2, 1.5, 2];
%     if we want to show the whole environment
    if get(handles.all_mesh_checkbox,'value')==1
        aabb = [-20, -20, -20; 20, 20, 20];
    end
    hMesh = robmap_h.Mesh(aabb);
    f = hMesh.FaceData;
    v = hMesh.VertexData;
    % save('datafile.mat','v');
    hold on;
    guiglobal.mesh_h=trisurf(f, v(:,1), v(:,2), v(:,3), 'FaceColor', 'None');
    axis equal
end


% REPLACE_WITH_DASH_DASH- Executes on button press in plot_planes_checkbox.
function plot_planes_checkbox_Callback(hObject, eventdata, handles)%#ok<DEFNU>
global plane guiglobal 
temp_mew=str2double(get(handles.temp_mew_edit,'String'));

theval=get(hObject,'Value');
if theval && ~isempty(plane)
     temp_plane_plot_handles=plot_planes(plane,temp_mew);
     if isfield(guiglobal,'plane_plot_handles')     
         guiglobal.plane_plot_handles=[guiglobal.plane_plot_handles;temp_plane_plot_handles];
     else
         guiglobal.plane_plot_handles=temp_plane_plot_handles;
     end
else
    for current_plane=1:size(guiglobal.plane_plot_handles,1); try delete(guiglobal.plane_plot_handles(current_plane)); end; end;
    guiglobal=rmfield(guiglobal, 'plane_plot_handles');
end

% REPLACE_WITH_DASH_DASH- Executes on button press in make_surface_pushbutton.
function make_surface_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
global robmap_h 
      
try aabb = [-1.5, -1.5, -1; 2, 1.5, 2];
hMesh = robmap_h.Mesh(aabb);
obsticlepoints = GetImpLevInfo(hMesh.VertexData);
catch; error('In getting the mesh needed for surface making');
end

temp_mew=str2double(get(handles.temp_mew_edit,'String'));
if size(obsticlepoints)>0
    set(handles.dialog_text,'String','Making planes....');drawnow;
    surface_making_simple(obsticlepoints,temp_mew);
    set(handles.dialog_text,'String','successfully made planes');
else
    set(handles.dialog_text,'String','There are no points to make surfaces out of');
end

% REPLACE_WITH_DASH_DASH- Executes on button press in rotate_pushbutton.
function rotate_pushbutton_Callback(hObject, eventdata, handles)%#ok<INUSD,DEFNU>
rotate3d;

% REPLACE_WITH_DASH_DASH- Executes on button press in ResetView.
function ResetView_Callback(hObject, eventdata, handles)%#ok<INUSD,DEFNU>
global guiglobal
try delete(guiglobal.mesh_h);end
set(gcf,'CurrentAxes',handles.axes3);
cla('reset')
camlight
lighting gouraud
axis equal
view(2);
colordef white

% REPLACE_WITH_DASH_DASH- Executes on button press in sideon_pushbutton.
function sideon_pushbutton_Callback(hObject, eventdata, handles)%#ok<INUSD,DEFNU>
axis equal;
view(3);

% REPLACE_WITH_DASH_DASH- Executes on button press in plotexplored_pushbutton.
function plotexplored_pushbutton_Callback(hObject, eventdata, handles)%#ok<DEFNU>
global workspace guiglobal
%can't plot before moving the robot once
if size(workspace.knowncoords,1)==0
   error('not valid when there are no explored (known) points'); 
else
    hold on;
    set(gcf,'CurrentAxes',handles.axes3);
    if ~isfield(guiglobal,'exploredplot')
        guiglobal.exploredplot=plot3(workspace.knowncoords(:,1),workspace.knowncoords(:,2),workspace.knowncoords(:,3),'r.');
        axis vis3d;grid on
    else
        try delete(guiglobal.exploredplot)
        catch display('cant delete the exploration plot');
        end
        guiglobal=rmfield(guiglobal,'exploredplot');
    end
end

% REPLACE_WITH_DASH_DASH- Executes on button press in plot_obstacles_pushbutton.
function plot_obstacles_pushbutton_Callback(hObject, eventdata, handles) %#ok<DEFNU>
global  workspace guiglobal
if size(workspace.indexedobsticles,1)==0
   error('not valid when there are no indexedobsticles points'); 
else
    set(gcf,'CurrentAxes',handles.axes3)
    hold on;
    if ~isfield(guiglobal,'obsticleplot')
        guiglobal.obsticleplot=plot3(workspace.indexedobsticles(:,1),workspace.indexedobsticles(:,2),workspace.indexedobsticles(:,3),'g.');
    else
        try delete(guiglobal.obsticleplot);
        catch display('cant delete the obsticle plot');
        end
        guiglobal=rmfield(guiglobal,'obsticleplot');
    end
end

% REPLACE_WITH_DASH_DASH- Executes on button press in show_unknownpoints_checkbox.
function show_unknownpoints_checkbox_Callback(hObject, eventdata, handles) %#ok<INUSD,DEFNU>
global guiglobal workspace
if ~get(hObject,'value')
    if isfield (guiglobal,'unknownplot')
        for i=1:size(guiglobal.unknownplot,2)
            try delete(guiglobal.unknownplot(i))
            catch display('Cant delete unknown points plot')
            end
        end
        guiglobal=rmfield(guiglobal,'unknownplot');
    end
else
    a=round(   workspace.unknowncoords(workspace.lev1unknown   ,:)/workspace.inc_size);
    b=round(     workspace.knowncoords(GetImpLevInfo(workspace.knowncoords)     ,:)/workspace.inc_size);
    c=round(workspace.indexedobsticles(GetImpLevInfo(workspace.indexedobsticles),:)/workspace.inc_size);
    [nothing,index]=setdiff(a,[b;c],'rows');
    
    if ~isempty(index>0)
        guiglobal.unknownplot(1)=plot3(workspace.unknowncoords(workspace.lev1unknown(index),1),...
                                   workspace.unknowncoords(workspace.lev1unknown(index),2),...
                                   workspace.unknowncoords(workspace.lev1unknown(index),3),...
                                   '.','Color',[1-workspace.dotweight(1) 1-workspace.dotweight(1) 1]);
    else
        display('No Unknown coordinates to plot');
    end
    
end

% REPLACE_WITH_DASH_DASH- Executes on button press in show_ellipses_checkbox.
function show_ellipses_checkbox_Callback(hObject, eventdata, handles) %#ok<DEFNU>
global r Q guiglobal densoobj
theval=get(hObject,'Value');
plotrob=get(handles.show_robot_checkbox,'Value');

if theval
    guiglobal.plot_ellipse=1;
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
else
    guiglobal.plot_ellipse=0;
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
end
%deletes the robot if it is not needed
if ~plotrob try for piece=1:size(densoobj,2); delete(densoobj(piece).patches); end; end; end;
    
% REPLACE_WITH_DASH_DASH- Executes on button press in show_robot_checkbox.
function show_robot_checkbox_Callback(hObject, eventdata, handles) %#ok<DEFNU>
global r Q guiglobal densoobj
theval=get(hObject,'Value');
if theval
    plotdenso(r, Q, guiglobal.checkFF, guiglobal.plot_ellipse);
else
    try for piece=1:size(densoobj,2); delete(densoobj(piece).patches); end; end
end

% REPLACE_WITH_DASH_DASH- Executes on button press in zoom_pushbutton.
function zoom_pushbutton_Callback(hObject, eventdata, handles)
zoom on;

%this function is used to collect the data for exploration to compare new info
function state_data=collectdata(state_data)
global workspace
if isempty(state_data)
    state_data.knownweight=calknownweight();
    state_data.unknownweight=calunknownweight();   
    state_data.size_known=size(workspace.knowncoords,1);
    state_data.size_unknown=size(setdiff(round(workspace.unknowncoords/workspace.inc_size),round(workspace.knowncoords/workspace.inc_size),'rows'),1);
    state_data.size_indexedobsticles=size(workspace.indexedobsticles,1);
    state_data.time=0;state_data.starttime=clock;
else
    state_data.knownweight=[state_data.knownweight,calknownweight()];
    state_data.unknownweight=[state_data.unknownweight,calunknownweight()];
    state_data.size_known=[state_data.size_known,size(workspace.knowncoords,1)];
    state_data.size_unknown=[state_data.size_unknown,size(setdiff(round(workspace.unknowncoords/workspace.inc_size),round(workspace.knowncoords/workspace.inc_size),'rows'),1)];
    state_data.size_indexedobsticles=[state_data.size_indexedobsticles,size(workspace.indexedobsticles,1)];
    state_data.time=[state_data.time,etime(clock,state_data.starttime)];
end    



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Not Used By Me
% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function best_NBV_listbox_CreateFcn(hObject, eventdata, handles)
if ispc
    set(hObject,'BackgroundColor','white');
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function slider1_CreateFcn(hObject, eventdata, handles)
usewhitebg = 1;
if usewhitebg
    set(hObject,'BackgroundColor',[.9 .9 .9]);
else
    set(hObject,'BackgroundColor',get(0,'defaultUicontrolBackgroundColor'));
end

% REPLACE_WITH_DASH_DASH- Executes on button press in useRealRobot_checkbox.
function useRealRobot_checkbox_Callback(hObject, eventdata, handles)

function tilt_scan_deg_edit_Callback(hObject, eventdata, handles)
% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function tilt_scan_deg_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% REPLACE_WITH_DASH_DASH- Joint 1 edit create and callback
function move_to_J1_edit_Callback(hObject, eventdata, handles)
function move_to_J1_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% REPLACE_WITH_DASH_DASH- Joint 2 edit create and callback
function move_to_J2_edit_Callback(hObject, eventdata, handles)
function move_to_J2_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

%REPLACE_WITH_DASH_DASH- Joint 3 edit create and callback
function move_to_J3_edit_Callback(hObject, eventdata, handles)
function move_to_J3_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% REPLACE_WITH_DASH_DASH- Joint 4 edit create and callback
function move_to_J4_edit_Callback(hObject, eventdata, handles)
function move_to_J4_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% REPLACE_WITH_DASH_DASH- Joint 5 edit create and callback
function move_to_J5_edit_Callback(hObject, eventdata, handles)
function move_to_J5_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% REPLACE_WITH_DASH_DASH- Joint 6 edit create and callback
function move_to_J6_edit_Callback(hObject, eventdata, handles)
function move_to_J6_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% REPLACE_WITH_DASH_DASH- Executes on button press in start_with_default_poses_checkbox.
function start_with_default_poses_checkbox_Callback(hObject, eventdata, handles)

% REPLACE_WITH_DASH_DASH- Executes on button press in animate_move_checkbox.
function animate_move_checkbox_Callback(hObject, eventdata, handles)

% REPLACE_WITH_DASH_DASH- Executes on button press in exact_joints_only_checkbox.
function exact_joints_only_checkbox_Callback(hObject, eventdata, handles)

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function temp_mew_edit_Callback(hObject, eventdata, handles)
function temp_mew_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
function Untitled_1_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
function Untitled_2_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
function Untitled_3_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_3 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
function Untitled_4_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_4 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
function Untitled_5_Callback(hObject, eventdata, handles)
% hObject    handle to Untitled_5 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASH- Executes on button press in all_mesh_checkbox.
function all_mesh_checkbox_Callback(hObject, eventdata, handles)
% hObject    handle to all_mesh_checkbox (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of all_mesh_checkbox





function rot_scan_deg_edit_Callback(hObject, eventdata, handles)


% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function rot_scan_deg_edit_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in scanwhilemove_checkbox.
function scanwhilemove_checkbox_Callback(hObject, eventdata, handles)

% REPLACE_WITH_DASH_DASH- Executes on button press in remv_unkn_in_mv_checkbox.
function remv_unkn_in_mv_checkbox_Callback(hObject, eventdata, handles)




##### SOURCE END #####
-->
   </body>
</html>